<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <!-- Syncfusion dialog --->
      <script src="//ej2.syncfusion.com/javascript/demos/dialog/modal-dialog/datasource.js"
         type="text/javascript"></script>
      <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js" type="text/javascript"></script>
      <link href="https://cdn.syncfusion.com/ej2/material.css" rel="stylesheet">
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
      <!---->
      <link rel="stylesheet" href="assets\css\bootstrap.min.css">
      <link rel="stylesheet" href="assets\css\all.min.css">
      <link rel="stylesheet" href="assets\css\animate.css">
      <link rel="stylesheet" href="assets\css\flaticon.css">
      <link rel="stylesheet" href="assets\css\magnific-popup.css">
      <link rel="stylesheet" href="assets\css\odometer.css">
      <link rel="stylesheet" href="assets\css\owl.carousel.min.css">
      <link rel="stylesheet" href="assets\css\owl.theme.default.min.css">
      <link rel="stylesheet" href="assets\css\nice-select.css">
      <link rel="stylesheet" href="assets\css\main.css">
      <link rel="shortcut icon" href="assets\images\favicon.png" type="image/x-icon">
      <script src="assets/js/ticketbooking.js"></script>
      <title>Boleto - Online Ticket Booking Website HTML Template</title>
   </head>
   <body>
      <!-- ==========Preloader========== -->
      <div class="preloader">
         <div class="preloader-inner">
            <div class="preloader-icon">
               <span></span>
               <span></span>
            </div>
         </div>
      </div>
      <!-- ==========Preloader========== -->
      <!-- ==========Overlay========== -->
      <div class="overlay"></div>
      <a href="#0" class="scrollToTop">
      <i class="fas fa-angle-up"></i>
      </a>
      <!-- ==========Overlay========== -->
      <!-- ==========Header-Section========== -->
      <header class="header-section">
         <div class="container">
            <div class="header-wrapper">
               <div class="logo">
                  <a href="index.html">
                  <img src="assets\images\logo\logo.png" alt="logo">
                  </a>
               </div>
               <ul class="menu">
                  <li>
                     <a href="index.html">Home</a>
                     <!-- <ul class="submenu">
                        <li>
                           <a href="index.html">Home One</a>
                        </li>
                        <li>
                           <a href="index-2.html">Home Two</a>
                        </li>
                     </ul> -->
                  </li>
                  <li>
                     <a href="movie-details.html" class="active">movies</a>
                     <!-- <ul class="submenu">
                        <li>
                           <a href="movie-grid.html">Movie Grid</a>
                        </li> -->
                        <!-- <li>
                           <a href="movie-list.html">Movie List</a>
                        </li>
                        <li>
                           <a href="movie-details.html">Movie Details</a>
                        </li>
                        <li>
                           <a href="movie-details-2.html">Movie Details 2</a>
                        </li>
                        <li>
                           <a href="movie-ticket-plan.html">Movie Ticket Plan</a>
                        </li>
                        <li>
                           <a href="#0" class="active">Movie Seat Plan</a>
                        </li>
                        <li>
                           <a href="movie-checkout.html">Movie Checkout</a>
                        </li>
                        <li>
                           <a href="popcorn.html">Movie Food</a>
                        </li> -->
                     <!-- </ul> -->
                  </li>
                      <li>
                        <a href="popcorn.html">FOOD & BEVARAGE</a>                    
                    </li>
                  <!-- <li>
                     <a href="#0">events</a>
                     <ul class="submenu">
                        <li>
                           <a href="events.html">Events</a>
                        </li>
                        <li>
                           <a href="event-details.html">Event Details</a>
                        </li>
                        <li>
                           <a href="event-speaker.html">Event Speaker</a>
                        </li>
                        <li>
                           <a href="event-ticket.html">Event Ticket</a>
                        </li>
                        <li>
                           <a href="event-checkout.html">Event Checkout</a>
                        </li>
                     </ul>
                  </li> -->
                  <!-- <li>
                     <a href="#0">sports</a>
                     <ul class="submenu">
                        <li>
                           <a href="sports.html">Sports</a>
                        </li>
                        <li>
                           <a href="sport-details.html">Sport Details</a>
                        </li>
                        <li>
                           <a href="sports-ticket.html">Sport Ticket</a>
                        </li>
                        <li>
                           <a href="sports-checkout.html">Sport Checkout</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="#0">pages</a>
                     <ul class="submenu">
                        <li>
                           <a href="about.html">About Us</a>
                        </li>
                        <li>
                           <a href="apps-download.html">Apps Download</a>
                        </li>
                        <li>
                           <a href="sign-in.html">Sign In</a>
                        </li>
                        <li>
                           <a href="sign-up.html">Sign Up</a>
                        </li>
                        <li>
                           <a href="404.html">404</a>
                        </li>
                     </ul>
                  </li>
                  <li>
                     <a href="#0">blog</a>
                     <ul class="submenu">
                        <li>
                           <a href="blog.html">Blog</a>
                        </li>
                        <li>
                           <a href="blog-details.html">Blog Single</a>
                        </li>
                     </ul>
                  </li>-->
                  <li> 
                     <a href="contact.html">Contact</a>
                  </li>
                  <li class="header-button pr-0">
                     <a href="sign-up.html">join us</a>
                  </li>
               </ul>
               <div class="header-bar d-lg-none">
                  <span></span>
                  <span></span>
                  <span></span>
               </div>
            </div>
         </div>
      </header>
      <!-- ==========Header-Section========== -->
      <!-- ==========Banner-Section========== -->
      <section class="details-banner hero-area bg_img seat-plan-banner"
         data-background="./assets/images/banner/banner04.jpg">
         <div class="container">
            <div class="details-banner-wrapper">
               <div class="details-banner-content style-two">
                  <h3 id="movie-title" class="title">Venus</h3>
                  <div class="tags">
                     <a id="theatre-name" href="#0">City Walk</a>
                     <a href="#0">English - 2D</a>
                  </div>
               </div>
            </div>
         </div>
      </section>
      <!-- ==========Banner-Section========== -->
      <!-- ==========Page-Title========== -->
      <section class="page-title bg-one">
         <div class="container">
            <div class="page-title-area">
               <div class="item md-order-1">
                  <a href="movie-ticket-plan.html" class="custom-button back-button">
                  <i class="flaticon-double-right-arrows-angles"></i>back
                  </a>
               </div>
               <div class="item date-item">
                  <span class="date">MON, SEP 09 2020</span>
                  <select class="select-bar" onchange="showChange()">
                     <option value="09:40">09:40</option>
                     <option value="13:45">13:45</option>
                     <option value="15:45">15:45</option>
                     <option value="19:50">19:50</option>
                  </select>
               </div>
               <div class="item">
                  <h5 class="title timecalculas">05:00</h5>
                  <p>Mins Left</p>
               </div>
            </div>
         </div>
      </section>
      <!-- ==========Page-Title========== -->
      <!-- ==========Movie-Section========== -->
      <div class="seat-plan-section padding-bottom padding-top">
         <div class="container">
            <div class="screen-area">
               <div class="screen-thumb">
                  <img src="assets\images\movie\screen-thumb.png" alt="movie">
               </div>
               <div id="layout" style="width: 790px;"></div>
            </div>
               <div class="proceed-book bg_img"
                  data-background="./assets/images/movie/movie-bg-proceed.jpg">
                  <div class="proceed-to-book">
                     <div class="book-item">
                        <span>Selected Seat</span>
                        <h3 class="selected_seat">-</h3>
                     </div>
                     <div class="book-item">
                        <span>total price</span>
                        <h3 class="selected_seat_total_amount">0</h3>
                     </div>
                     <div class="book-item">
                        <a href="popcorn.html" onclick="proceedFn(this)" class="custom-button">proceed</a>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- ==========Movie-Section========== -->
      <!-- ==========Newslater-Section========== -->
      <footer class="footer-section">
         <div class="newslater-section padding-bottom">
            <div class="container">
               <div class="newslater-container bg_img"
                  data-background="./assets/images/newslater/newslater-bg1.jpg">
                  <div class="newslater-wrapper">
                     <h5 class="cate">subscribe to Boleto </h5>
                     <h3 class="title">to get exclusive benifits</h3>
                     <form class="newslater-form">
                        <input type="text" placeholder="Your Email Address">
                        <button type="submit">subscribe</button>
                     </form>
                     <p>We respect your privacy, so we never share your info</p>
                  </div>
               </div>
            </div>
         </div>
         <div class="container">
            <div class="footer-top">
               <div class="logo">
                  <a href="index-1.html">
                  <img src="assets\images\footer\footer-logo.png" alt="footer">
                  </a>
               </div>
               <ul class="social-icons">
                  <li>
                     <a href="#0">
                     <i class="fab fa-facebook-f"></i>
                     </a>
                  </li>
                  <li>
                     <a href="#0" class="active">
                     <i class="fab fa-twitter"></i>
                     </a>
                  </li>
                  <li>
                     <a href="#0">
                     <i class="fab fa-pinterest-p"></i>
                     </a>
                  </li>
                  <li>
                     <a href="#0">
                     <i class="fab fa-google"></i>
                     </a>
                  </li>
                  <li>
                     <a href="#0">
                     <i class="fab fa-instagram"></i>
                     </a>
                  </li>
               </ul>
            </div>
            <div class="footer-bottom">
               <div class="footer-bottom-area">
                  <div class="left">
                     <p>Copyright © 220.All Rights Reserved By <a href="#0">Boleto </a></p>
                  </div>
                  <ul class="links">
                     <li>
                        <a href="#0">About</a>
                     </li>
                     <li>
                        <a href="#0">Terms Of Use</a>
                     </li>
                     <li>
                        <a href="#0">Privacy Policy</a>
                     </li>
                     <li>
                        <a href="#0">FAQ</a>
                     </li>
                     <li>
                        <a href="#0">Feedback</a>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
      </footer>
      <!-- ==========Newslater-Section========== -->
      <script src="assets\js\jquery-3.3.1.min.js"></script>
      <script src="assets\js\modernizr-3.6.0.min.js"></script>
      <script src="assets\js\plugins.js"></script>
      <script src="assets\js\bootstrap.min.js"></script>
      <script src="assets\js\isotope.pkgd.min.js"></script>
      <script src="assets\js\magnific-popup.min.js"></script>
      <script src="assets\js\owl.carousel.min.js"></script>
      <script src="assets\js\wow.min.js"></script>
      <script src="assets\js\countdown.min.js"></script>
      <script src="assets\js\odometer.min.js"></script>
      <script src="assets\js\viewport.jquery.js"></script>
      <script src="assets\js\nice-select.js"></script>
      <script src="assets\js\main.js"></script>
   </body>
   <style>
      div table .seatI,
      div table .seatI_dummy {
         margin: 5px;
         float: left;
         width: 23px;
         height: 22px;
      }
   
      div table .seatI a {
         display: inline-block;
         font-size: 10px;
         line-height: 25px;
         font-weight: 400;
         background: #fff;
         vertical-align: top;
      }

      td:nth-of-type(1) {
    padding-right: 20px;
  }
   
      div table a.avail {
         border: 1px solid rgb(49 215 82 / 85%);
      }
   
      div table a {
         display: inline-block;
         width: 25px;
         height: 25px;
         border-radius: 2px;
         color: #1ea83c;
         text-align: center;
         font-size: 10px;
      }
   
      div table a.e-selected {
         color: #fff;
         background-color: #1ea83c !important;
         border-color: #1ea83c;
      }
   
      div table a.e-booked {
         border: 1px solid #999999;
         background-color: grey;
         color: #666666;
         pointer-events: none;
      }
   
      #layout {
         margin: auto;
      }
   
      #layout.e-backdrop {
         
         pointer-events: none;
      }
   </style>
<script>
   document.addEventListener('DOMContentLoaded', () => {
      var showtime = JSON.parse(getShowTime("showtiming"));
   console.log(showtime);

   var movie = getMovieData("movieName")
      var showDetails = JSON.parse(getBookingTime("bookingscreen"))
      console.log(showDetails)

      document.getElementById("movie-title").innerText = movie;
      document.getElementById("theatre-name").innerText = showtime[0]["screenName"];


         const production = localStorage.getItem("LOCALIP") || "https://cinibot.ticketingapi.klartdigi.in";
        // var showDetails = JSON.parse(getShowTime("showtiming"));
        // document.getElementById("movie-title").innerText = showDetails[0]["movie"];
       //  console.log(showDetails);
         const dateParams = { SessionId: 2376 };
         const url = `${production}/api/browsing.svc/GetSeatPlan?SessionId=${dateParams.SessionId}`;
         var xhttp = new XMLHttpRequest();
         xhttp.open("GET", url, true);
         xhttp.setRequestHeader("Accept", "application/json");
         xhttp.setRequestHeader("Content-type", "application/json");
         xhttp.setRequestHeader("connectapitoken", "sVkzyAuRnME8Iel3bEic9A==");
         xhttp.send();
         xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
               const posSeat = JSON.parse(this.responseText).data;
               console.log(posSeat);
               genareteTable(posSeat);
            }
         };
      });
        function genareteTable(e) { 
            var table = document.createElement("table");
            for (var i = 0; i < e.Rows.length; i++) {
               var tr = document.createElement("tr");
               var td1 = document.createElement("td");
               td1.className = "seatR Setrow1";
               var text1 = document.createTextNode(e.Rows[i].RowName);
               td1.appendChild(text1);
               tr.appendChild(td1);
               for (var j = 0; j < e.Rows[i].Seats.length; j++) {
                  var td2 = document.createElement("td");
                  td2.id = e.Rows[i].RowName + "_" + e.Rows[i].Seats[j].id;
                  td2.className = "seatI";
                  td2.setAttribute("rowIndex", e.Rows[i].Seats[j].Position.RowIndex);
                  td2.setAttribute("colIndex", e.Rows[i].Seats[j].Position.ColumnIndex);
                  var anchor = document.createElement("a");
                  anchor.className = "avail";
                  anchor.href = "javascript:;";
                  anchor.addEventListener("click", e => {
                     seatSelect(e);
                     calculteRate(e);
                     calculteSeat(e);
                  });
                  var text1 = document.createTextNode(e.Rows[i].Seats[j].id);
                  anchor.appendChild(text1);
                  td2.appendChild(anchor);
                  tr.appendChild(td2);
               }
               table.appendChild(tr);
            }
            document.getElementById('layout').appendChild(table);
         }

         function seatSelect(e) {
            e.currentTarget.parentElement.firstElementChild.classList.toggle("e-selected");
         }

         function calculteRate() {
            var Total = 0;
            for (var i = 0; i < document.querySelectorAll('.e-selected').length; i++) {
               if (document.querySelectorAll('.e-selected')[i].parentElement.id.split('_')[0] <= "D") {
                  Total = Total + 60;
               } else {  Total = Total + 160; }
            }
            document.querySelectorAll('.selected_seat_total_amount')[0].innerText = '$' + Total;
         }
         function calculteSeat(args) {
            var selected_seat = '';
            for (var i = 0; i < document.querySelectorAll('.e-selected').length; i++) {
               selected_seat = selected_seat === '' ? selected_seat : selected_seat + ",";
               selected_seat = selected_seat + document.querySelectorAll('.e-selected')[i].parentElement.id.split('_')[0] + document.querySelectorAll('.e-selected')[i].parentElement.id.split('_')[1]
            }
            document.querySelectorAll('.selected_seat')[0].innerText = selected_seat;
          }

         function booked(args) {
            var array = args;
            for (var i = 0; i < document.getElementsByClassName('seatI').length; i++) {
               if (args.indexOf(document.getElementsByClassName('seatI')[i].id.split('_')[1] + document.getElementsByClassName('seatI')[i].id.split('_')[2]) != -1) {
                  document.getElementsByClassName('seatI')[i].firstElementChild.classList.add('e-booked');
               }
            }
         }

         function showChange(args) {
            refershTable();
            var value = document.getElementsByClassName("select-bar")[0].value;
            timeLeftCalculation(value);
            if (!document.getElementById('layout').classList.contains('e-backdrop')) {
               if (value == '13:45') {
                  booked(['A1', 'A2', 'A3', 'A4']);
               }
               else if (value == '15:45') {
                  booked(['B1', 'B2', 'B3', 'B4']);
               }
               else {
                  booked(['C1', 'C2', 'C3', 'C4']);
               }
            }
         }

         function refershTable() {

            for (var i = 0; i < document.getElementsByClassName('seatI').length; i++) {
               if (document.getElementsByClassName('seatI')[i].firstElementChild.classList.contains('e-selected') || document.getElementsByClassName('seatI')[i].firstElementChild.classList.contains('e-booked')) {
                  document.getElementsByClassName('seatI')[i].firstElementChild.classList.remove('e-selected');
                  document.getElementsByClassName('seatI')[i].firstElementChild.classList.remove('e-booked');
               }
            }
            document.querySelectorAll('.selected_seat_total_amount')[0].innerText = '$' + 0;
            document.querySelectorAll('.selected_seat')[0].innerText = '-';
         }

         function timeLeftCalculation(dropValue) {
            var dt1 = new Date().setHours(Number(dropValue.split(':')[0]));
            dt1 = new Date(dt1).setMinutes(Number(dropValue.split(':')[1]));
            dt1 = new Date(dt1);
            var dt2 = new Date();
            console.log(diff_hours(dt2, dt1))
         }

         function diff_hours(dt2, dt1) {
            var hourDiff = dt2.getHours() - dt1.getHours();
            var miDiff = dt2.getMinutes() - dt1.getMinutes();
            document.getElementsByClassName('timecalculas')[0].innerText = Math.abs(hourDiff) + 'h' + ':' + Math.abs(miDiff) + 'm';
            if (Math.abs(hourDiff) == 3 && Math.abs(miDiff) < 30) {
               document.getElementById('layout').classList.add('e-backdrop')
               alert("we can't book your ticker before 30 min");
            }
            else {
               document.getElementById('layout').classList.remove('e-backdrop')
            }
         }

         function proceedFn(e) {
            var tickets = document.getElementsByClassName('selected_seat')[0].innerText;
            var amount = document.getElementsByClassName('selected_seat_total_amount')[0].innerText;
            var movie = document.getElementById("movie-title").innerText;
            var theatre = document.getElementById("theatre-name").innerText;
            var proceedData = JSON.stringify([{ movie: movie, tickets: tickets, amount: amount, theatre: theatre }]);
            setProceedData("proceedData", proceedData);
         }

    </script>
</html>